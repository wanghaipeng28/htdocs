var JTopo={version:"0.3.0"};(function(i){function b(k){var j=this;this.name=k;this.messageMap={};this.messageCount=0;this.subscribe=function(m,n){if(!typeof m=="string"){l(m,n)}else{var o=j.messageMap[m];if(o==null){j.messageMap[m]=[]}j.messageMap[m].push(n);j.messageCount++}};function l(t,r){var p=[];var m=0;for(var o=0;o<t.length;o++){var n=t[o];var s=j.messageMap[n];if(s==null){j.messageMap[n]=[]}function q(u){p[o]=u;m++;if(m==t.length){m=0;return r.apply(null,p)}else{return null}}j.messageMap[n].push(q);j.messageCount++}}this.unsubscribe=function(m){var n=j.messageMap[m];if(n!=null){j.messageMap[m]=null;delete (j.messageMap[m]);j.messageCount--}};this.publish=function(m,p,o){var q=j.messageMap[m];if(q!=null){for(var n=0;n<q.length;n++){if(o){(function(s,r){setTimeout(function(){s(r)},10)})(q[n],p)}else{q[n](p)}}}}}function e(m,l){var k=l.x-m.x;var j=l.y-m.y;return Math.sqrt(k*k+j*j)}Array.prototype.del=function(k){if(typeof k!="number"){for(var j=0;j<this.length;j++){if(this[j]===k){return this.slice(0,j).concat(this.slice(j+1,this.length))}}return this}else{if(k<0){return this}return this.slice(0,k).concat(this.slice(k+1,this.length))}};if(![].indexOf){Array.prototype.indexOf=function(k){for(var j=0;j<this.length;j++){if(this[j]===k){return j}}return -1}}if(!window.console){window.console={log:function(j){},info:function(j){},debug:function(j){},warn:function(j){},error:function(j){}}}function g(j){if(j.pageX||j.pageY){return{x:j.pageX,y:j.pageY}}return{x:j.clientX+document.body.scrollLeft-document.body.clientLeft,y:j.clientY+document.body.scrollTop-document.body.clientTop}}function c(l,k){k=k||g(window.event);var j=document.body.scrollLeft+(k.x||k.layerX);var m=document.body.scrollTop+(k.y||k.layerY);return{x:j-l.offset.left,y:m-l.offset.top}}function h(m,l,p,n,k){var s=p-m;var q=n-l;var j=Math.sqrt(s*s+q*q);var o=Math.atan2(q,s)+k;return{x:m+Math.cos(o)*j,y:l+Math.sin(o)*j}}function d(n,l,o){var j=[];for(var k=0;k<l.length;k++){var m=h(n.x,n.y,l[k].x,l[k].y,o);j.push(m)}return j}function f(k,m,l){if(k.length==0){return}var o=0;function j(p){if(p==k.length){return}m(k[p]);setTimeout(function(){j(++p)},l)}j(o)}function a(l,k,p,o){if(k<l){return}var q=0;function j(m){if(m==k){return}p(k);setTimeout(function(){j(++m)},o)}j(q)}i.util={rotatePoint:h,rotatePoints:d,getDistance:e,getXY:c,mouseCoords:g,MessageBus:b};window.$for=a;window.$foreach=f})(JTopo);(function(b){var a=function(){};a.prototype.draw=function(){};a.prototype.getId=function(){return this.id};a.prototype.setId=function(c){this.id=c;return this};a.prototype.getFloatMenu=function(){return this.floatMenu};a.prototype.setFloatMenu=function(c){this.floatMenu=c;return this};a.prototype.isFloatMenuVisible=function(){return this.floatMenuVisible};a.prototype.setFloatMenuVisible=function(c){this.floatMenuVisible=c;return this};a.prototype.setX=function(c){this.x=c;return this};a.prototype.setY=function(c){this.y=c;return this};a.prototype.getX=function(){return this.x};a.prototype.getY=function(){return this.y};a.prototype.getLocation=function(c,d){return{x:this.getX(),y:this.getY()}};a.prototype.setLocation=function(c,d){this.setX(c);this.setY(d);return this};a.prototype.getWidth=function(){return this.width};a.prototype.setWidth=function(c){this.width=c;return this};a.prototype.getHeight=function(){return this.height};a.prototype.setHeight=function(c){this.height=c;return this};a.prototype.getSize=function(){return{width:this.getWidth(),height:this.getHeight()}};a.prototype.setSize=function(d,c){this.setWidth(d);this.setHeight(c);return this};a.prototype.setBound=function(d,f,e,c){this.setLocation(d,f);this.setSize(e,c);return this};a.prototype.getBound=function(){return{left:this.getX(),top:this.getY(),right:this.getX()+this.getWidth(),bottom:this.getY()+this.getHeight()}};a.prototype.isVisible=function(){return this.visible};a.prototype.setVisible=function(c){this.visible=c;return this};a.prototype.isDragable=function(){return this.dragable};a.prototype.setDragable=function(c){this.dragable=c;return this};a.prototype.isSelected=function(){return this.selected};a.prototype.setSelected=function(c){this.selected=c;return this};a.prototype.isFocus=function(){return this.focus};a.prototype.setFocus=function(c){this.focus=c;return this};a.prototype.onFocus=function(){this.setFocus(true);return this};a.prototype.loseFocus=function(){this.setFocus(false);return this};a.prototype.setTip=function(c){this.tip=c;return this};a.prototype.getTip=function(){return this.tip};a.prototype.onMousedown=function(c){console.log(this);this.setSelected(true);this.mousedownX=c.x;this.mousedownY=c.y;this.selectedLocation={x:this.getX(),y:this.getY()}};a.prototype.onMouseselected=function(){this.setSelected(true);this.selectedLocation={x:this.getX(),y:this.getY()}};a.prototype.goBack=function(c){};a.prototype.onMouseup=function(k){this.mouseupX=k.x;this.mouseupY=k.y;var o=k.x;var m=k.y;var g=k.context;if(this.gravitate){for(var f=0;f<g.links.length;f++){var n=g.links[f];if(this===n.nodeB){var h=g.findCloserNode(this,this.gravitate);var q={link:n,target:this,oldNode:this.lastParentNode,newNode:h};if(h&&h.layout&&h.layout.auto==true){g.layoutNode(h)}if(this.lastParentNode&&this.lastParentNode.layout&&this.lastParentNode.layout.auto==true){g.layoutNode(this.lastParentNode)}g.publish("gravitate",$.extend({},q));break}}}if(this.outContainer&&this.isIndrag){for(var d=0;d<g.containers.length;d++){var l=g.containers[d];if(!this.inContainer(l)){continue}if(this.parentContainer!==l){continue}if(this.x+this.width<l.x||this.x>l.x+l.width||this.y+this.height<l.y||this.y>l.y+l.height){this.parentContainer.remove(this);break}}}if(this.inContainer&&this.isOnMousedrag){for(var d=0;d<g.containers.length;d++){var p=g.containers[d];if(!this.inContainer(p)){continue}if(o>p.x&&o<p.x+p.width&&m>p.y&&m<p.y+p.height){if(this.parentContainer){this.parentContainer.remove(this)}p.add(this);break}}}if(this.layout&&this.layout.auto==true){g.layoutNode(this)}this.isOnMousedrag=false};a.prototype.cancleSelected=function(){this.setSelected(false);this.selectedLocation=null};a.prototype.onMouseover=function(c){this.isOnMousOver=true;this.isTipVisible=true;this.setFocus(true)};a.prototype.onMouseout=function(c){this.isOnMousOver=false;this.isTipVisible=false;this.setFocus(false)};a.prototype.onMousedrag=function(k){this.isOnMousedrag=true;var r=k.dx;var p=k.dy;var n=k.x;var m=k.y;var c=this.selectedLocation.x+r;var q=this.selectedLocation.y+p;this.setLocation(c,q);var g=k.context;if(this.gravitate){for(var f=0;f<g.links.length;f++){var l=g.links[f];if(this===l.nodeB){var h=g.findCloserNode(this,this.gravitate);if(h!=null&&h!==l.nodeA){if(this.lastParentNode==null){this.lastParentNode=l.nodeA}l.nodeA=h;break}}}}if(this.inContainer){for(var d=0;d<g.containers.length;d++){var o=g.containers[d];if(!this.inContainer(o)){continue}if(n>o.x&&n<o.x+o.width&&m>o.y&&m<o.y+o.height){o.setFocus(true)}else{o.setFocus(false)}}}this.isIndrag=true};b.Element=a})(JTopo);(function(b){function a(d){this.id=null;this.x=0;this.y=0;this.width=0;this.height=0;this.visible=true;this.dragable=true;this.name=d;this.image=null;this.color=null;this.layout=null;this.gravitate=null;this.parentContainer=null;this.inContainer=null;this.outContainer=null;this.fixed=false}a.prototype=new b.Element();a.prototype.getName=function(){return this.name};a.prototype.setName=function(d){this.name=d;return this};a.prototype.getImage=function(){return this.image};a.prototype.setImage=function(e){var f=this;if(typeof e=="string"){var d=this.image=new Image();this.image.onload=function(){f.setSize(d.width,d.height)};this.image.src=e}else{this.image=e}};var c={};a.prototype.getTypeImage=function(e){var d={zone:"./img/zone.png",host:"./img/host.png",vm:"./img/vm.png"};if(c[e]){return c[e]}var g=d[e];if(g==null){return null}var f=new Image();f.src=g;return c[e]=f};a.prototype.getType=function(){return this.type};a.prototype.setType=function(d){this.type=d;this.setImage(this.getTypeImage(d))};b.AbstractNode=a})(JTopo);(function(i){function g(j){this.name=j;this.width=35;this.height=35;this.x=0;this.y=0;this.style={fillStyle:"71, 167, 184",fontSize:"10pt",font:"Consolas"};this.type=null;this.selected=false;this.alpha=1;this.scala=1;this.rotate=0}g.prototype=new i.AbstractNode();g.prototype.drawText=function(j){var k=this.getName();if(!k||k==""){return}var l=j.measureText(k).width;j.font=this.style.fontSize+" "+this.style.font;j.strokeStyle="rgba(230, 230, 230, "+this.alpha+")";j.strokeText(k,-this.width/2+(this.width-l)/2,this.height/2+12)};g.prototype.drawTip=function(j){var k=this.getTip();if(!k||k==""){return}var l=j.measureText(k).width;j.save();j.beginPath();j.font=this.style.fontSize+" "+this.style.font;j.strokeStyle="rgba(230, 230, 230, "+this.alpha+")";if(l>this.width){j.strokeText(k,-this.wdith-2,-this.y-2)}else{j.strokeText(k,-this.width()+this.getWidth()-l-2,this.getY()-2)}j.stroke();j.closePath();j.restore()};g.prototype.drawSelectedRect=function(k){var l=k.measureText(this.getName()).width;var j=Math.max(this.width,l);k.save();k.beginPath();k.strokeStyle="rgba(168,202,255, 0.9)";k.fillStyle="rgba(168,202,236,0.5)";k.rect(-j/2-3,-this.height/2-2,j+6,this.height+16);k.fill();k.stroke();k.closePath();k.restore()};g.prototype.draw=function(j){if(!this.isVisible()){return}var k=this;j.save();j.translate(this.x+this.width/2,this.y+this.height/2);j.rotate(this.rotate);j.scale(this.scala,this.scala);if(k.isSelected()||k.isFocus()){this.drawSelectedRect(j)}var l=this.getImage();if(l!=null){j.drawImage(l,-this.width/2,-this.height/2)}else{j.beginPath();j.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";j.rect(-this.width/2,-this.height/2,this.width,this.height);j.fill();j.closePath()}this.drawText(j);if(this.isTipVisible){this.drawTip(j)}j.restore()};g.prototype.split=function(o){var k=this;function m(q,w,u,v,s){var t=new i.Node();t.setImage(k.image);t.setLocation(q,w);t.draw=function(r){r.save();r.arc(this.x+this.width/2,this.y+this.height/2,u,v,s);r.clip();r.beginPath();if(this.image!=null){r.drawImage(this.image,this.x,this.y)}else{r.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";r.rect(this.x,this.y,this.width,this.height);r.fill()}r.closePath();r.restore()};return t}var p=o;var j=o+Math.PI;var n=m(k.x,k.y,k.width,p,j);var l=m(k.x,k.y,k.width,p+Math.PI,p);return{nodeA:n,nodeB:l}};function b(j){var k=new i.Node(j);k.r=30;k.beginDegree=0;k.endDegree=2*Math.PI;k.draw=function(m){if(this.visible==false){return}var l=k.r*2*this.scala;var n=k.r*2*this.scala;this.setWidth(l);this.setHeight(n);m.save();m.beginPath();m.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";m.arc(k.x+l/2,k.y+n/2,l/2,this.beginDegree,this.endDegree,true);m.fill();m.closePath();m.restore()};return k}function e(){var j=new i.Node();j.setSize(120,120);j.draw=function(k){if(!this.visible){return}k.save();k.beginPath();k.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";k.moveTo(this.x+75,this.y+40);k.bezierCurveTo(this.x+75,this.y+37,this.x+70,this.y+25,this.x+50,this.y+25);k.bezierCurveTo(this.x+20,this.y+25,this.x+20,this.y+62.5,this.x+20,this.y+62.5);k.bezierCurveTo(this.x+20,this.y+80,this.x+40,this.y+102,this.x+75,this.y+120);k.bezierCurveTo(this.x+110,this.y+102,this.x+130,this.y+80,this.x+130,this.y+62.5);k.bezierCurveTo(this.x+130,this.y+62.5,this.x+130,this.y+25,this.x+100,this.y+25);k.bezierCurveTo(this.x+85,this.y+25,this.x+75,this.y+37,this.x+75,this.y+40);k.fill();k.closePath();k.restore()};return j}function h(j){var k=new i.Node(j);k.setSize(100,100);k.draw=function(m){if(!this.visible){return}var l=this.x;var n=this.y;m.save();m.beginPath();m.strokeStyle="rgba(230, 230, 230, 0.8)";m.moveTo(l+50,n);m.quadraticCurveTo(l,n,l,n+37.5);m.quadraticCurveTo(l,n+75,l+25,n+75);m.quadraticCurveTo(l+25,n+95,l+5,n+100);m.quadraticCurveTo(l+35,n+95,l+45,n+75);m.quadraticCurveTo(l+100,n+75,l+100,n+37.5);m.quadraticCurveTo(l+100,n,l+50,n);m.strokeText(k.name,k.x+20,k.y+20);m.stroke();m.closePath();m.restore()};return k}function a(j){var k=new i.Node(j);k.setHeight(14);k.style={strokeStyle:"rgba(255,255,255, 0.99)",fillStyle:"rgba(255,255,255, 0.5)"};k.draw=function(l){l.save();l.beginPath();l.font=this.style.fontSize+" "+this.style.font;var o=l.measureText(this.name).width;l.closePath();l.restore();k.width=o;if(!this.visible){return}if(k.selected){var m=this.x-(o>this.width?(o-this.width)/2:0);var n=Math.max(this.width,o);l.save();l.beginPath();l.rect(m-3,this.y-1,n+6,this.height+20);l.fill();l.stroke();l.closePath();l.restore()}l.save();l.beginPath();l.font=this.style.fontSize+" "+this.style.font;l.strokeStyle=this.style.strokeStyle;l.fillStyle=this.style.fillStyle;l.strokeText(k.name,k.x,k.y+12);l.stroke();l.fill();l.closePath();l.restore()};return k}function c(){var j=new i.Node();j.offset=10;j.draw=function(k){k.save();k.beginPath();k.shadowBlur=9;k.shadowColor="rgba(0,0,0,0.9)";k.shadowOffsetX=6;k.shadowOffsetY=6;k.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";k.moveTo(this.x+this.offset,this.y);k.lineTo(this.x+this.offset+this.width,this.y);k.lineTo(this.x+this.width,this.y+this.height);k.lineTo(this.x,this.y+this.height);k.lineTo(this.x+this.offset,this.y);k.fill();k.closePath();k.restore()};return j}function f(j){var k=new i.Node();k.style.fillStyle="71, 167, 184";k.className=j;k.rowHeight=18;k.width=168;k.classObj=null;k.draw=function(l){if(!this.visible){return}if(this.classObj!=null){k.operations=[];k.attributes=[];for(var o in this.classObj){var n=this.classObj[o];if(typeof n=="function"){this.operations.push("+ "+o)}else{this.attributes.push("- "+o)}}}if(k.operations==null||k.operations.length==0){k.operations=[" "]}if(k.attributes==null||k.attributes.length==0){k.attributes=[" "]}k.height=(k.operations.length+k.attributes.length+1)*k.rowHeight+3;l.save();l.beginPath();l.fillStyle="rgba(239,247,149,"+this.alpha+")";l.rect(this.x,this.y,this.width,this.getHeight());l.shadowBlur=0;l.shadowOffsetX=0;l.shadowOffsetY=0;l.fill();l.font=this.style.fontSize+" "+this.style.font;l.moveTo(this.x,this.y+k.rowHeight+3);l.lineTo(this.x+this.width,this.y+k.rowHeight+3);var r=l.measureText(k.className).width;l.strokeText(k.className,this.getX()+(this.getWidth()-r)/2,this.getY()+k.rowHeight);for(var p=0;p<this.operations.length;p++){var m=this.operations[p];l.strokeText(m,this.getX()+5,this.getY()+k.rowHeight+k.rowHeight*(p+1))}l.moveTo(this.x,this.y+k.rowHeight*(this.operations.length+1)+3);l.lineTo(this.x+this.width,this.y+k.rowHeight*(this.operations.length+1)+3);var s=this.y+k.rowHeight*(this.operations.length+1);for(var p=0;p<this.attributes.length;p++){var q=this.attributes[p];l.strokeText(q,this.getX()+5,s+this.rowHeight*(p+1))}l.stroke();l.closePath();l.restore()};return k}function d(k){var l=new i.Node(k);var j=l.draw;l.draw=function(n){if(!this.visible){return}var p=[];var r=l.width/3;var q=l.height/3;function m(t,u){var s=new i.Node();s.setSize(r,q);s.style.fillStyle="0,255,0";s.setDragable(false);s.setLocation(t,u);return s}p.push(m(this.x-r/2,this.y+this.height/2-q/2));p.push(m(this.x+this.width/2-r/2,this.y-q/2));p.push(m(this.x+this.width-r/2,this.y+this.height/2-q/2));p.push(m(this.x+this.width/2-r/2,this.y+this.height-q/2));if(this.isSelected()){for(var o=0;o<p.length;o++){p[o].draw(n)}}j.call(this,n)};return l}i.Node=g;i.CircleNode=b;i.GhomboidNode=c;i.TipNode=h;i.TextNode=a;i.HeartNode=e;i.UMLClassNode=f;i.EndPointNode=d})(JTopo);(function(d){function c(h,g){this.nodeA=h;this.nodeB=g;this.style={strokeStyle:"116, 166, 250",alpha:1,lineWidth:2}}c.prototype=new d.Element();c.prototype.draw=function(g){g.save();g.beginPath();g.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";g.lineWidth=this.style.lineWidth;g.moveTo(this.nodeA.x+this.nodeA.width/2,this.nodeA.y+this.nodeA.height/2);g.lineTo(this.nodeB.x+this.nodeB.width/2,this.nodeB.y+this.nodeB.height/2);g.stroke();g.closePath();g.restore()};c.prototype.getLength=function(){return getDistance(this.nodeA,this.nodeB)};function e(i,h){var g=new d.Link(i,h);g.fold="x";g.draw=function(j){var l=this.nodeA.x;var n=this.nodeA.y;var k=this.nodeB.x;var m=this.nodeB.y;var p=l;var o=n;if(l==k||n==m){j.save();j.beginPath();j.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";j.lineWidth=this.style.lineWidth;j.moveTo(this.nodeA.x+this.nodeA.width/2,this.nodeA.y+this.nodeA.height/2);j.lineTo(this.nodeB.x+this.nodeB.width/2,this.nodeB.y+this.nodeB.height/2);j.closePath();j.stroke();j.restore()}else{if(this.fold=="x"){p=l+(k-l)}else{o=n+(m-n)}j.save();j.beginPath();j.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";j.lineWidth=this.style.lineWidth;j.moveTo(l+this.nodeA.width/2,n+this.nodeA.height/2);j.lineTo(p+this.nodeA.width/2,o+this.nodeA.height/2);j.lineTo(k+this.nodeA.width/2,m+this.nodeA.height/2);j.stroke();j.closePath();j.restore()}};return g}function a(i,h){var g=new d.Link(i,h);g.curve=0.5;g.draw=function(j){var l=this.nodeA.x;var n=this.nodeA.y;var k=this.nodeB.x;var m=this.nodeB.y;var p=l;var o=n;p=l+(k-l);o=n+(m-n);p*=this.curve;o*=this.curve;j.save();j.beginPath();j.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";j.lineWidth=this.style.lineWidth;j.moveTo(l+this.nodeA.width/2,n+this.nodeA.height/2);j.quadraticCurveTo(p+this.nodeA.width/2,o+this.nodeA.height/2,k+this.nodeA.width/2,m+this.nodeA.height/2);j.stroke();j.closePath();j.restore()};return g}function f(i,h){var g=new d.Link(i,h);g.angle=0.4;g.offset=30;g.draw=function(k){k.save();k.beginPath();k.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";k.fillStyle="rgba("+this.style.fillStyle+","+this.style.alpha+")";k.lineWidth=this.style.lineWidth;var l={x:this.nodeA.x+this.nodeA.width/2,y:this.nodeA.y+this.nodeA.height/2};var n={x:this.nodeB.x+this.nodeB.width/2,y:this.nodeB.y+this.nodeB.height/2};var o=Math.atan2(l.y-n.y,l.x-n.x);n.x=n.x+Math.cos(o)*this.nodeB.width/2;n.y=n.y+Math.sin(o)*this.nodeB.height/2;var m=0.4;var j={x:n.x+Math.cos(o-m)*this.offset,y:n.y+Math.sin(o-m)*this.offset};var p={x:n.x+Math.cos(o+m)*this.offset,y:n.y+Math.sin(o+m)*this.offset};k.moveTo(this.nodeA.x+this.nodeA.width/2,this.nodeA.y+this.nodeA.height/2);k.lineTo(j.x+(p.x-j.x)/2,j.y+(p.y-j.y)/2);k.moveTo(j.x,j.y);k.lineTo(n.x,n.y);k.lineTo(p.x,p.y);k.lineTo(j.x,j.y);if(this.style.fillStyle!=null){k.fill()}k.stroke();k.closePath();k.restore()};return g}function b(i,h){var g=new d.Link(i,h);g.fold="x";g.angle=0.4;g.offset=30;g.draw=function(u){var l=this.nodeA.x;var p=this.nodeA.y;var k=this.nodeB.x;var o=this.nodeB.y;var r=l;var q=p;if(l==k||p==o){u.save();u.beginPath();u.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";u.lineWidth=this.style.lineWidth;var n={x:this.nodeA.x+this.nodeA.width/2,y:this.nodeA.y+this.nodeA.height/2};var s={x:this.nodeB.x+this.nodeB.width/2,y:this.nodeB.y+this.nodeB.height/2};var m=Math.atan2(n.y-s.y,n.x-s.x);s.x=s.x+Math.cos(m)*this.nodeB.width/2;s.y=s.y+Math.sin(m)*this.nodeB.height/2;var w=0.4;var j={x:s.x+Math.cos(m-w)*this.offset,y:s.y+Math.sin(m-w)*this.offset};var v={x:s.x+Math.cos(m+w)*this.offset,y:s.y+Math.sin(m+w)*this.offset};u.lineTo(j.x+(v.x-j.x)/2,j.y+(v.y-j.y)/2);u.moveTo(j.x,j.y);u.lineTo(s.x,s.y);u.lineTo(v.x,v.y);u.lineTo(j.x,j.y);if(this.style.fillStyle!=null){u.fill()}u.closePath();u.stroke();u.restore()}else{if(this.fold=="x"){r=l+(k-l)}else{q=p+(o-p)}u.save();u.beginPath();u.strokeStyle="rgba("+this.style.strokeStyle+","+this.style.alpha+")";u.lineWidth=this.style.lineWidth;u.moveTo(l+this.nodeA.width/2,p+this.nodeA.height/2);u.lineTo(r+this.nodeA.width/2,q+this.nodeA.height/2);var n={x:r+this.nodeA.width/2,y:q+this.nodeA.height/2};var s={x:this.nodeB.x+this.nodeB.width/2,y:this.nodeB.y+this.nodeB.height/2};var m=Math.atan2(n.y-s.y,n.x-s.x);s.x=s.x+Math.cos(m)*this.nodeB.width/2;s.y=s.y+Math.sin(m)*this.nodeB.height/2;var w=0.4;var j={x:s.x+Math.cos(m-w)*this.offset,y:s.y+Math.sin(m-w)*this.offset};var v={x:s.x+Math.cos(m+w)*this.offset,y:s.y+Math.sin(m+w)*this.offset};u.lineTo(j.x+(v.x-j.x)/2,j.y+(v.y-j.y)/2);u.moveTo(j.x,j.y);u.lineTo(s.x,s.y);u.lineTo(v.x,v.y);u.lineTo(j.x,j.y);if(this.style.fillStyle!=null){u.fill()}u.stroke();u.closePath();u.restore()}};return g}d.Link=c;d.FoldLink=e;d.CurveLink=a;d.ArrowsLink=f;d.ArrowsFoldLink=b})(JTopo);(function(b){function a(f){this.name=f;this.x=0;this.y=0;this.width=40;this.height=40;this.items=[];this.style={fillStyle:"193, 200, 254"};this.alpha=0.3;this.dragable=true}a.prototype=new b.Element();a.prototype.add=function(f){this.items.push(f);f.parentContainer=this};a.prototype.remove=function(g){for(var f=0;f<this.items.length;f++){if(this.items[f]===g){g.parentContainer=null;this.items=this.items.del(f);g.lastParentContainer=this;break}}};a.prototype.removeAll=function(){for(var f=0;f<this.items.length;f++){this.remove(this.items[f])}};a.prototype.setLocation=function(f,l){var h=f-this.getX();var g=l-this.getY();this.setX(f);this.setY(l);for(var j=0;j<this.items.length;j++){var k=this.items[j];k.setLocation(k.getX()+h,k.getY()+g)}};a.prototype.updateBound=function(){var l={x:10000000,y:1000000,width:0,height:0};if(this.items.length>0){var k=10000000;var g=-10000000;var j=10000000;var f=-10000000;var h=g-k;var n=f-j;for(var m=0;m<this.items.length;m++){var o=this.items[m];if(o.x<=k){k=o.x}if(o.x>=g){g=o.x}if(o.y<=j){j=o.y}if(o.y>=f){f=o.y}h=g-k+o.width;n=f-j+o.height}this.x=k-5;this.y=j-5;this.width=h+5;this.height=n+5}};a.prototype.draw=function(f){this.updateBound();f.save();f.beginPath();f.shadowBlur=9;f.shadowColor="rgba(0,0,0,0.5)";f.shadowOffsetX=3;f.shadowOffsetY=3;f.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";f.fillRect(this.x,this.y,this.width,this.height);f.closePath();f.restore()};function d(){var f=new b.Container();f.offset=50;f.draw=function(g){this.updateBound();g.save();g.beginPath();g.shadowBlur=9;g.shadowColor="rgba(0,0,0,0.9)";g.shadowOffsetX=6;g.shadowOffsetY=6;g.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";g.moveTo(this.x+this.offset,this.y);g.lineTo(this.x+this.offset+this.width,this.y);g.lineTo(this.x+this.width,this.y+this.height);g.lineTo(this.x,this.y+this.height);g.lineTo(this.x+this.offset,this.y);g.fill();g.stroke();g.closePath();g.restore()};return f}function c(){var f=new b.Container();f.rows=3;f.cols=2;f.cellWidth=60;f.cellHeight=60;f.offset=3;f.adjustLayout=function(){for(var h=0;h<this.items.length;h++){var j=this.items[h];var k=Math.floor(h/this.cols);var g=h%this.cols;j.x=this.x+g*f.cellWidth;j.y=this.y+k*f.cellHeight}};f.add=function(h){var g=this.items.length;if(g==this.rows*this.cols){return}this.items.push(h);h.parentContainer=this;this.adjustLayout()};f.draw=function(g){f.width=f.cols*f.cellWidth;f.height=f.rows*f.cellHeight;g.save();g.beginPath();g.shadowBlur=12;g.shadowColor="rgba(0,0,0,0.9)";g.shadowOffsetX=5;g.shadowOffsetY=3;g.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";var h=0;if(f.isFocus()){h=this.offset;g.shadowColor="rgba(0,0,200, 1)";g.fillRect(this.x-h,this.y-h,this.width+h*2,this.height+h*2)}else{g.shadowColor="rgba(0,0,0,0.5)";g.fillRect(this.x,this.y,this.width,this.height)}g.stroke();g.closePath();g.restore()};return f}function e(){var f=new b.GridContainer();f.rows=1;f.cols=1;f.cellWidth=50;f.cellHeight=50;f.setDragable(false);f.style.fillStyle="0,100,100";f.alpha=0.5;return f}b.Container=a;b.GridContainer=c;b.OneItemContainer=e;b.GhomboidContainer=d})(JTopo);(function(a){function b(d,c){this.name=d;this.canvas=c;this.ctx=this.canvas.getContext("2d");this.width=this.canvas.width;this.height=this.canvas.height;this.messageBus=new a.util.MessageBus();this.image=new Image();this.image.src="./img/bg.jpg";this.init()}b.prototype.init=function(){this.ctx.shadowBlur=5;this.ctx.shadowColor="rgba(0,0,0,0.5)";this.ctx.shadowOffsetX=3;this.ctx.shadowOffsetY=6;this.startDragMouseX=0;this.startDragMouseY=0;this.offset=$(canvas).offset();this.isRangeSelectable=true;this.elements=[];this.containers=[];this.links=[];this.nodes=[];this.elementMap={};this.selectedElements=[];var c=this;this.canvas.onmousedown=function(e){c.isMousedown=true;c.mousedown(e)};this.canvas.onmousemove=function(e){c.mousemove(e)};this.canvas.onmouseup=function(e){c.isMousedown=false;c.mouseup(e)};try{window.addEventListener("keydown",function(f){c.keydown(f)},true);window.addEventListener("keyup",function(f){c.keyup(f)},true)}catch(d){}setTimeout(function(){c.updateView()},300)};b.prototype.getElementByXY=function(c,j){var h=null;for(var d=this.nodes.length-1;d>=0;d--){var f=this.nodes[d];if(c>f.x&&c<f.x+f.width&&j>f.y&&j<f.y+f.height){h=f;break}}if(!h){for(var d=this.containers.length-1;d>=0;d--){var g=this.containers[d];if(c>g.x&&c<g.x+g.width&&j>g.y&&j<g.y+g.height){h=g;break}}}return h};b.prototype.getElementByName=function(c){for(var d=this.nodes.length-1;d>=0;d--){if(this.nodes[d].getName()==c){return this.nodes[d]}}return null};b.prototype.findCloserNode=function(g,f){var d={distance:Number.MAX_VALUE,node:null};for(var c=this.nodes.length-1;c>=0;c--){var e=this.nodes[c];if(e===g){continue}if(f(e)==true){var h=a.util.getDistance(g,e);if(h<d.distance){d.node=e;d.distance=h}}}return d.node};b.prototype.cancleAllSelected=function(){for(var c=0;c<this.selectedElements.length;c++){this.selectedElements[c].cancleSelected()}this.selectedElements=[]};b.prototype.mousedown=function(g){var f=this;var j=a.util.getXY(f,g);var c=j.x;var k=j.y;var h=f.getElementByXY(c,k);if(h!=null){h.onMousedown({x:c,y:k,context:f});f.currElement=h}else{if(f.currElement){f.currElement.cancleSelected();f.currElement=null}}f.startDragMouseX=c;f.startDragMouseY=k;if(f.currElement){if(f.selectedElements.indexOf(f.currElement)==-1){f.cancleAllSelected();f.selectedElements.push(f.currElement)}}else{f.cancleAllSelected()}for(var d=0;d<f.selectedElements.length;d++){var e=f.selectedElements[d];e.selectedLocation={x:e.x,y:e.y}}f.isOnMouseDown=true;f.publish("mousedown",{target:f.currElement,x:c,y:k,context:f})};b.prototype.mousemove=function(e){var j=this;var o=a.util.getXY(j,e);var l=o.x;var k=o.y;var p=(l-j.startDragMouseX);var n=(k-j.startDragMouseY);j.publish("mousemove",{target:j.currElement,x:l,y:k,dx:p,dy:n,context:j});j.updateView();for(var h=this.nodes.length-1;h>=0;h--){var g=this.nodes[h];if(g.x+g.width<0||g.x>j.canvas.width){continue}if(l>g.x&&l<g.x+g.width&&k>g.y&&k<g.y+g.height){g.onMouseover({x:l,y:k,dx:p,dy:n,context:j});j.publish("mouseover",{target:g,x:l,y:k,dx:p,dy:n,context:j})}else{if(g.isOnMousOver){g.onMouseout({x:l,y:k,dx:p,dy:n,context:j});j.publish("mouseout",{target:g,x:l,y:k,dx:p,dy:n,context:j})}}}if(j.currElement&&j.isOnMouseDown&&j.currElement.isDragable()){for(var h=0;h<j.selectedElements.length;h++){var g=j.selectedElements[h];g.onMousedrag({x:l,y:k,dx:p,dy:n,context:j})}j.publish("mousedrag",{target:j.currElement,x:l,y:k})}else{if(j.isOnMouseDown&&j.isRangeSelectable){var d=l>=j.startDragMouseX?j.startDragMouseX:l;var c=k>=j.startDragMouseY?j.startDragMouseY:k;var f=Math.abs(l-j.startDragMouseX);var m=Math.abs(k-j.startDragMouseY);j.ctx.beginPath();j.ctx.fillStyle="rgba(168,202,236,0.5)";j.ctx.fillRect(d,c,f,m);j.ctx.closePath();for(var h=0;h<j.nodes.length;h++){var g=j.nodes[h];if(g.x+g.width<0||g.x>j.canvas.width){continue}if(g.x>d&&g.x+g.width<d+f){if(g.y>c&&g.y+g.height<c+m){g.onMouseselected({x:l,y:k,dx:p,dy:n,context:j});j.selectedElements.push(g)}}else{g.cancleSelected()}}}}};b.prototype.mouseup=function(g){var f=this;var h=a.util.getXY(this,g);var c=h.x;var i=h.y;var e=(c-f.startDragMouseX);var d=(i-f.startDragMouseY);f.publish("mouseup",{target:f.currElement,x:c,y:i,dx:e,dy:d,context:f});f.startDragMouseX=null;if(f.currElement){f.currElement.onMouseup({x:c,y:i,context:f,dx:e,dy:d})}f.updateView();f.isOnMouseDown=false};b.prototype.keydown=function(d){var c=this;var f=d.keyCode?d.keyCode:d.which;c.publish("keydown",f);c.updateView();return;if(f===17){}if(f===18){}if(f===16){}if(f===27){this.cancleAllSelected();this.currElement=null}if(f===38||f===87){if(this.currElement){this.currElement.y-=5}}if(f===39||f===68){if(this.currElement){this.currElement.x+=5}}if(f===40||f===83){if(this.currElement){this.currElement.y+=5}}if(f===37||f===65){if(this.currElement){this.currElement.x-=5}}c.updateView()};b.prototype.keyup=function(d){var c=this;var f=d.keyCode?d.keyCode:d.which;c.publish("keyup",f);c.updateView()};b.prototype.subscribe=function(c,d){this.messageBus.subscribe(c,d);return this};b.prototype.publish=function(c,d){this.messageBus.publish(c,d);return this};b.prototype.removeElementById=function(d){for(var c=0;c<this.elements.length;c++){if(this.elements[c].id==d){this.remove(c);break}}};b.prototype.remove=function(c){this.elements=this.elements.del(c);this.containers=this.containers.del(c);this.links=this.links.del(c);this.nodes=this.nodes.del(c);this.elementMap[c.id]=c};b.prototype.addElement=function(c){return this.add(c)};b.prototype.add=function(c){if(this.elementMap[c.id]!=null){return}if(!c.id){c.id=$.now()}if(!c.z){c.z=this.elements.length}this.elements.push(c);if(c instanceof a.Container){this.containers.push(c)}else{if(c instanceof a.Link){this.links.push(c)}else{if(c instanceof a.Node){this.nodes.push(c)}}}this.elementMap[c.id]=c};b.prototype.clear=function(){this.elements=[];this.links=[];this.nodes=[];this.containers=[];this.elementMap={}};b.prototype.getChilds=function(e){var c=[];for(var d=0;d<this.links.length;d++){if(this.links[d].nodeA===e){c.push(this.links[d].nodeB)}}return c};b.prototype.getNodesBound=function(e){var j={x:10000000,y:1000000,width:0,height:0};if(e.length>0){var h=10000000;var d=-10000000;var g=10000000;var c=-10000000;var f=d-h;var l=c-g;for(var k=0;k<e.length;k++){var m=e[k];if(m.x<=h){h=m.x}if(m.x>=d){d=m.x}if(m.y<=g){g=m.y}if(m.y>=c){c=m.y}f=d-h+m.width;l=c-g+m.height}j.x=h;j.y=g;j.width=f;j.height=l;return j}return null};b.prototype.isAllChildIsEndpoint=function(e){var f=this.getChilds(e);for(var d=0;d<f.length;d++){var c=this.getChilds(f[d]);if(c.length>0){return false}}return true};b.prototype.getBoundRecursion=function(c){var d=this.getChilds(c);if(d.length==0){return c.getBound()}return this.getNodesBound(d)};b.prototype.layoutNode=function(d){var e=this.getChilds(d);if(e.length==0){return d.getBound()}this.adjustPosition(d);if(this.isAllChildIsEndpoint(d)){return null}for(var c=0;c<e.length;c++){this.layoutNode(e[c])}return null};b.prototype.adjustPosition=function(g){var h=this.getChilds(g);var f=g.layout;var e=f.type;var d=null;if(e=="star"){d=a.Layout.getStarPositions(g.x,g.y,h.length,g.layout.radius,g.layout.beginDegree,g.layout.endDegree)}else{if(e=="tree"){d=a.Layout.getTreePositions(g.x,g.y,h.length,f.width,f.height,f.direction)}}for(var c=0;c<h.length;c++){h[c].setLocation(d[c].x,d[c].y)}};b.prototype.getParents=function(e){var c=[];for(var d=0;d<this.links.length;d++){if(this.links[d].nodeB===e){c.push(this.links[d].nodeA)}}return c};b.prototype.updateView=function(){var g=this;var d=this.nodes;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);if(this.image!=null){this.ctx.drawImage(this.image,0,0)}for(var e=0;e<this.links.length;e++){var f=this.links[e];if(f.nodeA.x+f.nodeA.width<0||f.nodeA.x>g.canvas.width){continue}if(f.nodeB.x+f.nodeA.width<0||f.nodeB.x>g.canvas.width){continue}f.draw(this.ctx)}for(var e=0;e<this.containers.length;e++){var h=this.containers[e];if(h.x+h.width<0||h.x>g.canvas.width){continue}this.containers[e].draw(this.ctx)}for(var e=0;e<this.nodes.length;e++){if(this.nodes[e].x+this.nodes[e].width<0||this.nodes[e].x>g.canvas.width){continue}this.nodes[e].draw(this.ctx)}};a.DataBox=b})(JTopo);(function(b){function a(p,o,j,k,l,m){var e=l?l:0;var g=m?m:2*Math.PI;var n=g-e;var f=n/j;var s=[];e+=f/2;for(var h=e;h<=g;h+=f){var r=p+Math.cos(h)*k;var q=o+Math.sin(h)*k;s.push({x:r,y:q})}return s}function c(n,l,k,e,h,g){var m=g||"bottom";var o=[];if(m=="bottom"){var f=n-(k/2)*e+e/2;for(var j=0;j<=k;j++){o.push({x:f+j*e,y:l+h})}}else{if(m=="top"){var f=n-(k/2)*e+e/2;for(var j=0;j<=k;j++){o.push({x:f+j*e,y:l-h})}}else{if(m=="right"){var f=l-(k/2)*e+e/2;for(var j=0;j<=k;j++){o.push({x:n+h,y:f+j*e})}}else{if(m=="left"){var f=l-(k/2)*e+e/2;for(var j=0;j<=k;j++){o.push({x:n-h,y:f+j*e})}}}}}return o}function d(n,l,k,e,h,g){var m=g||"horizontal";var p=[];var o=Math.round(k/2);var f=n+e;if(m=="horizontal"){for(var j=0;j<o;j++){p.push({x:f+j*e,y:l-h})}for(var j=o;j<=k;j++){p.push({x:f+j*e,y:l+h})}}else{if(m=="vertical"){}}return p}b.Layout={getStarPositions:a,getTreePositions:c,getBusPositions:d}})(JTopo);(function(k){var c=false;function j(q,o){var p=o.context;var s=o.gravity||0.1;var m=null;var n={};function l(){window.clearInterval(m);if(n.onStop){n.onStop(q)}return n}function r(){var u=o.dx||0,t=o.dy||2;m=setInterval(function(){if(c){n.stop();return}t+=s;if(q.y+q.height<p.canvas.height){q.setLocation(q.x+u,q.y+t);p.updateView()}else{t=0;l()}},20);return n}n.run=r;n.stop=l;n.onStop=function(t){n.onStop=t;return n};return n}function e(r,p){var q=p.context;var n=null;var o={};var l=p.v;function s(){n=setInterval(function(){if(c){o.stop();return}r.rotate+=l||0.2;if(r.rotate>2*Math.PI){r.rotate=0}q.updateView()},100);return o}function m(){window.clearInterval(n);if(o.onStop){o.onStop(r)}return o}o.run=s;o.stop=m;o.onStop=function(t){o.onStop=t;return o};return o}function g(m,p){var o=p.context;var l=m.style;var t={};function s(u,B,z,A,v){var w=new k.Node();w.setImage(m.image);w.setSize(m.width,m.height);w.setLocation(u,B);w.draw=function(x){x.save();x.arc(this.x+this.width/2,this.y+this.height/2,z,A,v);x.clip();x.beginPath();if(this.image!=null){x.drawImage(this.image,this.x,this.y)}else{x.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")";x.rect(this.x,this.y,this.width,this.height);x.fill()}x.closePath();x.restore()};return w}function q(y,x){var z=y;var w=y+Math.PI;var v=s(m.x,m.y,m.width,z,w);var u=s(m.x-2+Math.random()*4,m.y,m.width,z+Math.PI,z);m.setVisible(false);x.add(v);x.add(u);x.updateView();k.Animation.gravity(v,{context:x,dx:0.3}).run().onStop(function(A){x.remove(v);x.remove(u);x.updateView();t.stop()});k.Animation.gravity(u,{context:x,dx:-0.2}).run()}function n(){q(p.angle,o);return t}function r(){if(t.onStop){t.onStop(m)}return t}t.onStop=function(u){t.onStop=u;return t};t.run=n;t.stop=r;return t}function i(m,q){var u=0.8;var l=2;var o=0;var p=q.context;m.isSelected=function(){return false};m.isFocus=function(){return false};m.setDragable(false);function r(x){x.setVisible(true);x.rotate=Math.random();var t=p.canvas.width/2;x.x=t+Math.random()*(t-100)-Math.random()*(t-100);x.y=p.canvas.height;x.vx=Math.random()*5-Math.random()*5;x.vy=-25}var v=null;var w={};function n(){r(m);v=setInterval(function(){if(c){w.stop();return}m.vy+=u;m.x+=m.vx;m.y+=m.vy;if(m.x<0||m.x>p.canvas.width||m.y>p.canvas.height){if(w.onStop){w.onStop(m)}r(m)}p.updateView()},50);return w}function s(){window.clearInterval(v)}w.onStop=function(t){w.onStop=t;return w};w.run=n;w.stop=s;return w}function a(){c=true}function h(){c=false}function d(n,s){var y=s.p1;var x=s.p2;var q=s.context;var w=y.x+(x.x-y.x)/2;var v=y.y+(x.y-y.y)/2;var l=k.util.getDistance(y,x)/2;var p=Math.atan2(v,w);var m=s.speed||0.2;var A={};var z=null;function o(){z=setInterval(function(){if(c){A.stop();return}var r=y.y+w+Math.sin(p)*l;n.setLocation(n.x,r);q.updateView();p+=m},100);return A}function u(){window.clearInterval(z)}A.run=o;A.stop=u;return A}function b(m,q){var l=q.position;var o=q.context;var r=q.easing||0.2;var v={};var u=null;function n(){u=setInterval(function(){if(c){v.stop();return}var t=l.x-m.x;var p=l.y-m.y;var x=t*r;var w=p*r;m.x+=x;m.y+=w;o.updateView();if(x<0.01&&w<0.1){s()}},100);return v}function s(){window.clearInterval(u)}v.onStop=function(p){v.onStop=p;return v};v.run=n;v.stop=s;return v}function f(m,q){var l=q.position;var o=q.context;var r=q.scala||1;var w=0.06;var s=m.scala;var y={};var x=null;function n(){x=setInterval(function(){m.scala+=w;if(m.scala>=r){u()}o.updateView()},100);return y}function u(){if(y.onStop){y.onStop(m)}m.scala=s;window.clearInterval(x)}y.onStop=function(p){y.onStop=p;return y};y.run=n;y.stop=u;return y}k.Animation={gravity:j,dividedTwoPiece:g,repeatThrow:i,rotate:e,cycle:d,move:b,scala:f,stopAll:a,startAll:h}})(JTopo);
