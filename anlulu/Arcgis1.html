<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <link rel="stylesheet" href="https://openlayers.org/en/v3.19.1/css/ol.css">
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://openlayers.org/en/v3.19.1/build/ol.js"></script>
  <title>Draw type</title>
 </head>
 <body>
	<div id='map' class='map'></div>	<!--创建一个div用来保存地图-->
	<form action="" class='form-line'>
		<label for="">Shape type &nbsp;</label>
		<select name="" id="type">				<!--创建一个下拉列表-->
			<option value="Square">Square</option>
			<option value="Box">Box</option>
			<option value="Star">Star</option>
			<option value="None">None</option>
		</select>
	</form>
	<script>
		var raster=new ol.layer.Tile({    //创建一个新的瓷砖图层
			source:new ol.source.OSM()	  //创建一个来源地图			
		});

		var source=new ol.source.Vector({wrapX:false});//创建一个新的矢量数据源
		var vector=new ol.layer.Vector({//创建一个新的矢量图层
			soucer:source
		});
		var map=new ol.Map({//OpenLayers3的核心部件是Map，用来实例化一个地图对象
			layers:[raster,vector],//地图对象包含的所有图层，每个图层分别是数组的一个元素
			target:'map',//html页面上容器div
			view:new ol.View({//实例化一个视图
				center:[-11000000,4600000],//指定视图的中心坐标
				zoom:4//缩放值，用来指定地图的分辨率可用的缩放级别由maxZoom （默认值为28）、zoomFactor （默认值为2）、maxResolution （默认由投影在256×256像素瓦片的有效成都来计算） 决定
			})
		});
		var typeSelect=document.getElementById('type');
		var draw;
		function addInteraction(){
			var value=typeSelect.value;
			if (value!=='None'){
				var geometryFunction;
			if (value==='Square'){
				value='Circle';
				geometryFunction=ol.interaction.Draw.createRegularPolygon(4);
			}else if (value==='Box'){
				value='Circle';
				geometryFunction=ol.interaction.Draw.createBox();
			}else if (value==='Star'){
				value='Circle';
				geometryFunction=function(coordinates,geometry){if(!geometry){
					geometry=new ol.geom.Polygon(null);
				}
				var center=coordinates[0];
				var last=coordinates[1];
				var dx=center[0]-last[0];
				var dy=center[1]-last[1];
				var radius=Math.sqrt(dx*dx+dy*dy);
				var rotation=Math.atan2(dy,dx);
				var newCoordinates=[];
				var numPoinys=12;
				for (var i=0;i<numPoints ;i++ ){
					var angle=rotation+i*2*Math.PI/numPoints;
					var fraction=i%2===0?1:0.5;
					var offsetX=radius*fraction*Math.cos(angle);
					offsetY=radius*fraction*Math.sin(angle);
					newCoordinates.push([center[0]+offsetX,center[1]+offsetY]);
				}
				newCoordinates.push(newCoordinates[0].slice());
				geometry.setCoordinates([newCoordinates]);
				return geometry;
			};
			}
			draw=new ol.interaction.Draw({
				soure:soure,
				type:(value),
				geometryFunction:geometryFunction
			});
			map.addInteraction(draw);
		}
		}
		typeSelect.onchange=function(){
			map.removeInteraction(draw);
			addInteraction();
		};
		addInteraction();
	</script>
 </body>
</html>
